<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">

    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="0">
    <meta http-equiv="Cache-Control" content="no-cache, mustrevalidate">
    <meta http-equiv="Pragma" content="no-cache">

    <title>JMFighters - cuenta</title>
    <link rel="shortcut icon" href="images/jm_logo.jpeg" />

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="css/animate.css">

    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">


    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="css/jquery.timepicker.css">

    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- NAV -->
    <div class="nav">
        <div class="wrap">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 d-flex align-items-center">
                        <p class="mb-0 location">
                            <span class="fa fa-map-marker mr-2"></span> Calle Greco, nº 2, local 1, Magalluf, Calvia, 07181, Islas Baleares, España.
                        </p>
                    </div>
                    <div class="col-md-6 d-flex justify-content-md-end">
                        <div class="social-media">
                            <p class="mb-0 d-flex">
                                <a href="https://www.facebook.com/JMFIGHTERS" class="d-flex align-items-center justify-content-center"><span class="fa fa-facebook"><i class="sr-only">Facebook</i></span></a>
                                <a href="https://www.instagram.com/jm_fighters/" class="d-flex align-items-center justify-content-center"><span class="fa fa-instagram"><i class="sr-only">Instagram</i></span></a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
            <div class="container">
                <a class="navbar-brand" href="index.html">JM Fighters</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="oi oi-menu"></span> Menu
                </button>

                <div class="collapse navbar-collapse" id="ftco-nav">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item"><a href="index.html" class="nav-link">Inicio</a></li>
                        <li class="nav-item"><a href="contacto.html" class="nav-link">Contacto</a></li>
                        <li class="nav-item"><a href="booking.html" class="nav-link">Cita previa</a></li>
                        <!--<li class='nav-item'><a href='fighters.html' class='nav-link'>Fighters</a></li>-->
                        <li class="nav-item active" id="userPage"><a href="userPage.html" class="nav-link">Cuenta</a></li>
                        <li class="nav-item" id="cmsList"></li>
                        <li class='nav-item'><a class='nav-link' data-toggle='modal' data-target='#user_form'><span class="fa fa-user-circle"></span></a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
    <!-- END nav -->

    <section class="hero-wrap hero-wrap-2 js-fullheight" style="background-color: #1f1f1f;max-height:300px">
        <div class="container">
            <div class="row slider-text align-items-end" style="height:300px;">
                <div class="col-md-9 ftco-animate pb-5">
                    <h1 class="mb-0 bread">Gestión de la cuenta</h1>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active booking" onclick="selectUserBookings()">Mis reservas</a>
            </li>
            <li class="nav-item">
                <a class="nav-link class" onclick="selectCount()">Cuenta</a>
            </li>
        </ul>

        <section class="m-3">
            <div class="container booking" style="display:block">
                <form onsubmit="onBookingSearchClick()">
                    <div class="row justify-content-between">
                        <input type="text" name="date" class="form-control datepicker datepicker_cms col-3" id="date" autocomplete="off" required>
                        <input type="submit" class="btn btn-primary col-3" value="ver">

                    </div>
                </form>
                <ul class="list-group list-group-flush" id="bookingList">
                </ul>
            </div>
            <div class="container count" style="display:none">
                <form class="p-5 bg-light" method="POST" id="updateUser" onsubmit="onEditUser()">
                    <div class="form-group">
                        <label for="nameuser">Nombre de usuario</label>
                        <input type="text" class="form-control" id="updateUsername" name="username" readonly value="" required>
                    </div>
                    <div class="form-group">
                        <label for="dni">DNI</label>
                        <input type="text" class="form-control" id="updateDni" name="dni" value="" readonly required>
                    </div>
                    <div class="form-group">
                        <label for="name">Nombre y apellidos</label>
                        <input type="text" class="form-control" id="updateName" name="name" value="" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" class="form-control" id="updateEmail" name="email" value="" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Modificar</button>
                </form>
                <span class="btn btn-secondary" data-toggle='modal' data-target='#user_pass'>Cambiar contraseña</span>
                <div class="modal" id="user_pass">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form class="p-5 bg-light class" method="POST" id="changePass" name="changePass" onsubmit="onChangePass()">
                                <div class="modal-header">
                                    <h4 class="modal-title">Cambio de contraseña</h4>
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <div class="comment-form-wrap pt-5">
                                        <div class="form-group">
                                            <input type="text" name="id" hidden id="id"/>
                                            <input type="text" name="password" id="password" hidden/>
                                            <label for="oldPass">Antigua contraseña</label>
                                            <input type="password" class="form-control" id="oldPass" name="oldPass" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="newPass">Nueva contraseña</label>
                                            <input type="password" class="form-control" id="newPass" name="newPass" required>
                                        </div>
                                    </div>
                                </div>
                                <!-- Modal footer -->
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary">Cambiar</button>
                                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="container">
        </div>
    </footer>
    <!-- END FOOTER -->

    <!-- Usuario -->
    <div class="userModals"></div>

    <!-- loader -->
    <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" /><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00" /></svg></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>

    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/jquery.animateNumber.min.js"></script>
    <script src="js/bootstrap-datepicker.js"></script>
    <script src="js/jquery.timepicker.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/scrollax.min.js"></script>
    <script charset="UTF-8" src="js/main.js"></script>

    <div id="scripts"></div>
</body>
<script charset="UTF-8">
    $user = null;
    loadUserModal();
    getUserSessionUserPage();

    $('.datepicker_cms').datepicker({
        language: 'es',
        autoclose: true,
        weekStart: 1,
        format: 'dd-mm-yyyy'
    });

    function selectUserBookings() {
        $("div.booking").show();
        $('div.count').hide();

        $('a.booking').addClass('active');
        $('a.count').removeClass('active');
    };

    function selectCount() {
        $("div.booking").hide();
        $('div.count').show();

        $('a.booking').removeClass('active');
        $('a.count').addClass('active');

        loadCount();
    };

    function onBookingSearchClick() {
        event.preventDefault();
        var date = $('#date').val();

        jQuery.ajax({
            type: "POST",
            async: false,
            url: 'functions.php',
            dataType: 'json',
            data: { functionName: 'getUserBookingsDay', date: date },
            success: function (obj, textstatus) {
                $html = "";
                $scripts = "<script>";
                if (obj['error']) {
                    $html = '<h6>' + obj['error'] + '</h6>';
                } else {					
					$today = new Date();
					$dNow = $today.getDate();
					$mNow = $today.getMonth()+1;
					$yNow = $today.getFullYear();
					$today = new Date($mNow+'\/'+$dNow+'\/'+$yNow);

                    for (var i = 0; i < obj['result'].length; i++) {
						$date = obj["result"][i]['date'];
						$dSelected = $date.substring(0,2);
						$mSelected = $date.substring(3,5);
						$ySelected = $date.substring(6);
						$dateFormated = new Date($mSelected+'\/'+$dSelected+'\/'+$ySelected);
						
                        $html = $html + '<li class="list-group-item"><h6>';
                        if ($today.getTime() < $dateFormated.getTime()) {
                            $html = $html + '<span onclick="cancelClass_' + obj['result'][i]['id'] + '()" class="fa fa-times btn btn-danger"></span>';
                        }
                        $html = $html + ' ' + obj['result'][i].date + " - "
                            + obj['result'][i].hour + " - "
                            + obj['result'][i].class;
                        $html = $html + '</h6></li>'
                        $scripts = $scripts + 'function cancelClass_' + obj['result'][i]['id'] + '(){'
                            + 'if(confirm("¿Deseas cancelar esta reserva?")){'
                            + 'cancelBook(' + parseInt(obj['result'][i]['id']) + ');'
                            + 'onBookingSearchClick();'
                            + '}'
                            + '}';
                    }
                }
                $scripts = $scripts + '<\/script>';
                $('#bookingList').html($html);
                $('#scripts').html($scripts);
				event.preventDefault();
			},
            error: function (xhr, status, error) {
				alert("No se ha podido conectar.");
				event.preventDefault();
			}
		});
    };

    function loadCount() {

    };
</script>
</html>
                